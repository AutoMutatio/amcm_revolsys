# requires the following libraries to be installed
# /usr/lib/libfgdblinuxrtl.so
#/usr/lib/libFileGDBAPI.so

ARCH=amd64
ESRI_FILE_GBD_HOME=/opt/EsriFileGdb-1.1/
OS=linux
ESRI_FILE_GBD_INCLUDE=/opt/EsriFileGdb-1.1/include

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${ESRI_FILE_GBD_HOME}/lib/${OS}/${ARCH}
echo $LD_LIBRARY_PATH
rm -f src/main/java/com/revolsys/gis/esri/gdb/file/capi/swig/*.java

mkdir -p target/cxx
mkdir -p target/o
mkdir -p src/main/java/com/revolsys/gis/esri/gdb/file/capi/swig/

swig -c++ \
  -o target/cxx/EsriFileGdb_wrap.cxx \
  -java \
  -package com.revolsys.gis.esri.gdb.file.capi.swig \
  -outdir src/main/java/com/revolsys/gis/esri/gdb/file/capi/swig \
  -Isrc/main/swig \
  -I${ESRI_FILE_GBD_INCLUDE}/linux/x86 \
  src/main/swig/EsriFileGdbAPI.i

mkdir -p target/o
mkdir -p target/lib
g++ \
  -fpic \
  -lFileGDBAPI \
  -lfgdblinuxrtl \
  -I${ESRI_FILE_GBD_INCLUDE}/${OS}/${ARCH} \
  -I$JAVA_HOME/include/ \
  -c target/cxx/EsriFileGdb_wrap.cxx \
  -o target/o/EsriFileGdb.o
  
g++ \
  -O2 \
  -fpic \
  -shared \
  -lFileGDBAPI \
  -lfgdblinuxrtl \
  target/o/EsriFileGdb.o \
  -o target/lib/libEsriFileGdbJni.so

cp target/lib/libEsriFileGdbJni.so src/main/resources/native/libEsriFileGdbJni-$ARCH-$OS.so

